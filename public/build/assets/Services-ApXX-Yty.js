var G=Object.defineProperty;var _=(a,i,o)=>i in a?G(a,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[i]=o;var C=(a,i,o)=>(_(a,typeof i!="symbol"?i+"":i,o),o);import{j as s}from"./FileViewer-CpM0iYLI.js";import{r as c}from"./index-B80Lgev0.js";import{B as A}from"./Base-DHRMjX9Z.js";import{c as M}from"./ReactAppend-CBRQCQGz.js";import{r as O}from"./DxBox-CdMuSyGE.js";import{S as V}from"./sweetalert2.all-Dh0rZL5X.js";import{B as q}from"./Results-B9dLaNz0.js";import{M as z}from"./Modal-CbHkO7Dn.js";import{T as J}from"./Table-CEq6jy84.js";import{I as L}from"./ImageFormGroup-D0l3yP43.js";import{I as P}from"./InputFormGroup-DZ3W53Mr.js";import{D as S}from"./DxButton-CsjWvhyj.js";import{C as W}from"./CreateReactScript-Bj11ghWz.js";import{R as f}from"./ReactAppend-C-tNgxIf.js";import{S as N}from"./SwitchFormGroup-ChGOZLEW.js";import{L as H}from"./Filter-CcOrv0Sz.js";import"./tippy-react.esm-CHhA99mn.js";import"./index-DO3Aws4m.js";/* empty css              */import"./Logout-Cj6nvmS-.js";import"./main-Br9xqDfn.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";import"./index.esm-CTa_PdWD.js";import"./axios-B4uVmeYG.js";import"./useTranslation-AtUXdXvN.js";/* empty css               */class K extends q{constructor(){super(...arguments);C(this,"path","admin/services");C(this,"hasFiles",!0)}}const m=new K,Q=({brands:a})=>{const[i,o]=c.useState([]),p=c.useRef(),d=c.useRef(),h=c.useRef(),x=c.useRef(),v=c.useRef(),u=c.useRef(),n=c.useRef(),[R,g]=c.useState([]),[k,b]=c.useState([{value:""}]),[y,T]=c.useState(!1),w=e=>{o(e||null),T(!!(e!=null&&e.id)),h.current.value=(e==null?void 0:e.id)||"",x.current.value=(e==null?void 0:e.title)||"",v.current.value=(e==null?void 0:e.description)||"",u.current.value=null;const r=(e==null?void 0:e.color)&&e.color!=="transparent"&&e.color!=="";if(o({...e,transparent_color:!r,color:r?e==null?void 0:e.color:"transparent"}),r?n.current.value=e==null?void 0:e.color:(n.current.value="#000000",n.current.dataset.prevColor="#000000"),e!=null&&e.icon&&(u.image.src=`/api/service/media/${e.icon}`),e!=null&&e.gallery){console.log(e==null?void 0:e.gallery);const t=e.gallery.map(j=>({url:`/api/service/media/${j}`,isNew:!1}));g(t)}else g([]);e!=null&&e.characteristics&&e.characteristics.length>0?b(e.characteristics.map(t=>({value:t}))):b([{value:""}]),$(d.current).modal("show")},F=async e=>{e.preventDefault();const r=new FormData;r.append("title",x.current.value),r.append("description",v.current.value),r.append("color",i!=null&&i.transparent_color?"transparent":n.current.value),y&&r.append("id",h.current.value),u.current.files[0]&&r.append("icon",u.current.files[0]),R.filter(l=>l.isNew).forEach((l,I)=>{r.append(`gallery[${I}]`,l.file)});const t=R.filter(l=>!l.isNew).map(l=>l.url.split("/").pop());r.append("existing_gallery",JSON.stringify(t));const j=k.map(l=>l.value.trim()).filter(l=>l.length>0);r.append("characteristics",JSON.stringify(j)),await m.save(r)&&($(p.current).dxDataGrid("instance").refresh(),$(d.current).modal("hide"),g([]),b([{value:""}]),n.current.value="#000000",u.current.value=null)},E=async e=>{const{isConfirmed:r}=await V.fire({title:"Eliminar Servicio",text:"¿Estás seguro de eliminar este servicio?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!r||!await m.delete(e)||$(p.current).dxDataGrid("instance").refresh()},B=async({id:e,value:r})=>{await m.boolean({id:e,field:"visible",value:r})&&$(p.current).dxDataGrid("instance").refresh()},D=async({id:e,value:r})=>{await m.boolean({id:e,field:"featured",value:r})&&$(p.current).dxDataGrid("instance").refresh()};return s.jsxs(s.Fragment,{children:[s.jsx(J,{gridRef:p,title:"Servicios",rest:m,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(p.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar nuevo servicio",onClick:()=>w()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"title",caption:"Título",width:"200px"},{dataField:"description",caption:"Descripción",cellTemplate:(e,{data:r})=>{e.html(O(s.jsx("div",{className:"text-truncate",style:{maxWidth:"300px"},children:r.description})))}},{dataField:"icon",caption:"Icono",width:"80px",cellTemplate:(e,{data:r})=>{r.icon?f(e,s.jsx("img",{src:`/api/service/media/${r.icon}`,style:{width:"40px",height:"40px",objectFit:"cover",borderRadius:"4px"},onError:t=>t.target.src="/images/default-icon.png",className:"bg-secondary p-1"})):e.html('<span class="text-muted">Sin icono</span>')}},{dataField:"color",caption:"Color",width:"80px",cellTemplate:(e,{data:r})=>{const t=!r.color||r.color==="transparent"||r.color==="";f(e,s.jsxs("div",{className:"d-flex align-items-center",children:[t?s.jsx("div",{style:{width:"30px",height:"20px",borderRadius:"3px",border:"1px solid #ddd",marginRight:"5px",backgroundImage:"linear-gradient(45deg, #f0f0f0 25%, transparent 25%, transparent 50%, #f0f0f0 50%, #f0f0f0 75%, transparent 75%, transparent)",backgroundSize:"8px 8px"}}):s.jsx("div",{style:{width:"30px",height:"20px",backgroundColor:r.color,borderRadius:"3px",border:"1px solid #ddd",marginRight:"5px"}}),s.jsx("small",{children:t?"Transparente":r.color})]}))}},{dataField:"featured",caption:"Destacado",dataType:"boolean",cellTemplate:(e,{data:r})=>{$(e).empty(),f(e,s.jsx(N,{checked:r.featured==1,onChange:()=>D({id:r.id,value:!r.featured})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",cellTemplate:(e,{data:r})=>{$(e).empty(),f(e,s.jsx(N,{checked:r.visible==1,onChange:()=>B({id:r.id,value:!r.visible})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:r})=>{e.append(S({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>w(r)})),e.append(S({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>E(r.id)}))}}]}),s.jsxs(z,{modalRef:d,title:y?"Editar Servicio":"Nuevo Servicio",onSubmit:F,size:"xl",children:[s.jsx("input",{ref:h,type:"hidden"}),s.jsxs("div",{className:"row",children:[s.jsxs("div",{className:"col-md-8",children:[s.jsx(P,{eRef:x,label:"Título del servicio",required:!0}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Descripción"}),s.jsx("textarea",{ref:v,className:"form-control",rows:4,required:!0})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Color del servicio"}),s.jsxs("div",{className:"d-flex align-items-center",children:[s.jsx("input",{ref:n,type:"color",className:"form-control form-control-color me-2",defaultValue:"#000000",title:"Selecciona un color",disabled:i==null?void 0:i.transparent_color,onChange:e=>{o({...i,color:e.target.value})}}),s.jsxs("div",{className:"form-check",children:[s.jsx("input",{className:"form-check-input",type:"checkbox",id:"transparentColorCheck",checked:i==null?void 0:i.transparent_color,onChange:e=>{const r=n.current.value;if(e.target.checked)n.current.dataset.prevColor=r,n.current.value="",o({...i,transparent_color:!0,color:"transparent"});else{const t=n.current.dataset.prevColor||"#000000";n.current.value=t,o({...i,transparent_color:!1,color:t})}}}),s.jsx("label",{className:"form-check-label",htmlFor:"transparentColorCheck",children:"Sin color (transparente)"})]})]})]})]}),s.jsx("div",{className:"col-md-4",children:s.jsx(L,{eRef:u,label:"Icono del servicio",aspect:1/1})})]})]})]})};W((a,i)=>{M(a).render(s.jsx(H,{children:s.jsx(A,{...i,title:"Servicios",children:s.jsx(Q,{...i})})}))});
